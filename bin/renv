#!/usr/bin/env node

var argv = require("yargs")
  .usage("Usage: $0 <config location> [profile]")
  .example("$0 http://server/env.json", "Use first or only environment encountered at env.json on server")
  .example("$0 http://server/env.json prod", "Use env 'prod' from env.json on server")
  .example("$0 http://server/env.json prod-limitworker", "merge and use content from 'prod' and 'limitworker'" +
     "from env.json on server, latter environment has higher priority")
  .demand(1)
  .argv;

var renv = require("../lib/renv");

var environmentLocation = argv._[0];
var environmentNames;

if (argv._.length > 1) {
  environmentNames = argv._[1].split("-");
}

renv.getEnv(environmentLocation, environmentNames, function (err, env) {
  if (err) {
    console.error(err.toString());
    process.exit(1);
  }

  Object.keys(env).forEach(function (k) {
    console.log("echo \"Setting " + k + "\";");
    console.log("export " + k + "=\"" + env[k] + "\";");
  });

  console.log("echo Done;");
});
